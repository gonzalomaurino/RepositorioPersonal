# =====================================================
# API GATEWAY - CONFIGURACIÓN
# =====================================================

# Puerto del Gateway
server.port=${GATEWAY_PORT:8080}

# =====================================================
# KEYCLOAK - CONFIGURACIÓN OAUTH2/OIDC
# =====================================================

# URL del Issuer (usado como fallback si no se especifica allowed-issuers)
# Si obtenés tokens desde localhost, usá localhost en issuer-uri
spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_ISSUER_URI:http://localhost:9090/realms/tpi-backend}

# Lista de issuers permitidos (separados por coma)
# Esto permite validar tokens obtenidos tanto internamente (keycloak:9090) como externamente (localhost:9090)
# Formato: issuer1,issuer2,issuer3
spring.security.oauth2.resourceserver.jwt.allowed-issuers=${KEYCLOAK_ALLOWED_ISSUERS:http://localhost:9090/realms/tpi-backend,http://keycloak:9090/realms/tpi-backend}

# URL del JWK Set (puede ser diferente, usar URL interna de Docker)
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${KEYCLOAK_JWK_SET_URI:http://keycloak:9090/realms/tpi-backend/protocol/openid-connect/certs}

# =====================================================
# KEYCLOAK - AUTH ENDPOINTS (para AuthController)
# =====================================================

# Token endpoint de Keycloak (URL interna de Docker)
keycloak.auth.token-uri=${KEYCLOAK_AUTH_TOKEN_URI:http://keycloak:9090/realms/tpi-backend/protocol/openid-connect/token}

# Client ID registrado en Keycloak
keycloak.auth.client-id=${KEYCLOAK_CLIENT_ID:tpi-client}

# Client Secret (opcional, solo si el cliente requiere autenticación)
keycloak.auth.client-secret=${KEYCLOAK_CLIENT_SECRET:}

# =====================================================
# RUTAS - MICROSERVICIOS
# =====================================================

# URLs internas de microservicios (Docker network)
servicio.gestion.url=${SERVICIO_GESTION_URL:http://servicio-gestion:8081}
servicio.flota.url=${SERVICIO_FLOTA_URL:http://servicio-flota:8082}
servicio.logistica.url=${SERVICIO_LOGISTICA_URL:http://servicio-logistica:8083}

# =====================================================
# SPRING CLOUD GATEWAY - RUTAS
# =====================================================

# Ruta: Servicio Gestión
spring.cloud.gateway.routes[0].id=servicio-gestion
spring.cloud.gateway.routes[0].uri=${servicio.gestion.url}
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/gestion/**

# Ruta: Servicio Flota
spring.cloud.gateway.routes[1].id=servicio-flota
spring.cloud.gateway.routes[1].uri=${servicio.flota.url}
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/flota/**

# Ruta: Servicio Logística
spring.cloud.gateway.routes[2].id=servicio-logistica
spring.cloud.gateway.routes[2].uri=${servicio.logistica.url}
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/logistica/**

# =====================================================
# CORS - CONFIGURACIÓN
# =====================================================

spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOrigins=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowCredentials=false

# =====================================================
# ACTUATOR - HEALTH CHECKS
# =====================================================

management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always

# =====================================================
# LOGGING
# =====================================================

logging.level.root=${GATEWAY_LOG_LEVEL:INFO}
logging.level.org.springframework.security=${SECURITY_LOG_LEVEL:DEBUG}
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.com.tpi.gateway=DEBUG
